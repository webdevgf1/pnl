<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PNL Faker: PNL Card Generator</title>
    <link rel="icon" type="image/png" href="https://cdn.prod.website-files.com/69082c5061a39922df8ed3b6/693a0c6553a7f8ffb034d09d_G2lRjt4X0AAcnAL%20(2).png">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gif-encoder-2@1.0.5/dist/GIFEncoder.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        @font-face {
            font-family: 'Geist-Regular';
            src: url('./fonts/Geist-Regular.otf') format('opentype');
            font-weight: 400;
            font-style: normal;
        }
        
        @font-face {
            font-family: 'Geist-Medium';
            src: url('./fonts/Geist-Medium.otf') format('opentype');
            font-weight: 500;
            font-style: normal;
        }
        
        @font-face {
            font-family: 'Geist-SemiBold';
            src: url('./fonts/Geist-SemiBold.otf') format('opentype');
            font-weight: 600;
            font-style: normal;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
    font-family: 'MS Sans Serif', sans-serif;
    background-image: url('https://cdn.prod.website-files.com/69082c5061a39922df8ed3b6/693a0cb623fed783a59ca4a5_74f3f9a6fec84acd2d0eae74ba00e070.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    height: 100vh;
    overflow: hidden;
    cursor: default;
}

        /* Desktop Icons */
        .desktop {
            position: relative;
            width: 100%;
            height: 100vh;
            padding: 20px;
        }

        .desktop-icon {
            position: absolute;
            width: 80px;
            text-align: center;
            cursor: pointer;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            user-select: none;
        }

        .desktop-icon:hover {
            background: rgba(0, 0, 255, 0.3);
            border: 1px dotted white;
        }

        .desktop-icon img {
            width: 48px;
            height: 48px;
            margin-bottom: 5px;
            image-rendering: pixelated;
        }

        .desktop-icon span {
            display: block;
            font-size: 11px;
            font-weight: bold;
        }

        .icon-twitter { top: 20px; left: 20px; }
        .icon-pumpfun { top: 20px; left: 120px; }
        /* Windows 98 Application Window */
        .window {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 1200px;
            height: 85%;
            background: #c0c0c0;
            border: 2px outset #c0c0c0;
            box-shadow: 2px 2px 10px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            font-family: 'MS Sans Serif', sans-serif;
        }

        .title-bar {
            background: linear-gradient(90deg, #0000ff, #000080);
            color: white;
            padding: 2px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 11px;
            font-weight: bold;
        }

        .title-text {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .window-icon {
            width: 16px;
            height: 16px;
            background: #ffff00;
            border: 1px solid #000;
        }

        .window-controls {
            display: flex;
            gap: 2px;
        }

        .control-btn {
            width: 16px;
            height: 14px;
            background: #c0c0c0;
            border: 1px outset #c0c0c0;
            font-size: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-btn:active {
            border: 1px inset #c0c0c0;
        }

        .window-content {
            flex: 1;
            padding: 10px;
            background: #c0c0c0;
            overflow-y: auto;
            display: flex;
            gap: 15px;
        }

        /* Form Section */
        .form-section {
            width: 300px;
            background: #f0f0f0;
            border: 2px inset #c0c0c0;
            padding: 15px;
            height: fit-content;
        }

        /* Desktop GIFs */
.desktop-gif {
    position: absolute;
    z-index: 1;
    pointer-events: none; /* So they don't interfere with clicking */
    opacity: 0.8; /* Slightly transparent */
}

.gif-1 {
    top: 15%;
    left: 5%;
    width: 120px;
    height: 120px;
}

.gif-2 {
    top: 60%;
    left: 90%;
    width: 120px;
    height: 120px;
}

.gif-3 {
    top: 25%;
    right: 3%;
    width: 120px;
    height: 120px;
}

.gif-4 {
    bottom: 20%;
    left: 15%;
    width: 120px;
    height: 120px;
}

.gif-5 {
    top: 45%;
    left: 5%;
    width: 120px;
    height: 120px;
}

        .form-group {
            margin-bottom: 12px;
        }

        .form-group label {
            display: block;
            margin-bottom: 3px;
            font-size: 11px;
            font-weight: bold;
            color: #000;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 2px;
            border: 2px inset #c0c0c0;
            background: white;
            font-size: 11px;
            font-family: 'MS Sans Serif', sans-serif;
        }

        .form-group input:focus, .form-group select:focus {
            outline: 1px dotted #000;
        }

        .win98-button {
            background: #c0c0c0;
            border: 2px outset #c0c0c0;
            padding: 4px 12px;
            font-size: 11px;
            font-family: 'MS Sans Serif', sans-serif;
            cursor: pointer;
            margin: 5px 0;
        }

        .win98-button:active {
            border: 2px inset #c0c0c0;
        }

        .win98-button.primary {
            background: #0000ff;
            color: white;
        }

        .background-section {
            border-top: 1px solid #808080;
            padding-top: 10px;
            margin-top: 10px;
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .file-input-label {
            background: #c0c0c0;
            border: 2px outset #c0c0c0;
            padding: 4px 12px;
            font-size: 11px;
            cursor: pointer;
            display: block;
            text-align: center;
        }

        .file-input-label:active {
            border: 2px inset #c0c0c0;
        }

        /* Preview Section */
        .preview-section {
            flex: 1;
            background: #f0f0f0;
            border: 2px inset #c0c0c0;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: auto;
        }

        .card-container {
            margin: 20px 0;
        }

        .card-preview {
            width: 840px;
            height: 570px;
            position: relative;
            background-image: url('https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/683495c0f008abc19b88aaf3_FINALPNLCARDdddd.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            border: 2px inset #c0c0c0;
            cursor: default;
        }

        .custom-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 1;
        }

        .pnl-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 2;
            pointer-events: none;
        }

        .profile-pic {
            position: absolute;
            top: 449px;
            left: 33px;
            width: 48px;
            height: 48px;
            border-radius: 6px;
            object-fit: cover;
            z-index: 3;
            display: none;
        }

        .draggable-text {
            position: absolute;
            user-select: none;
            pointer-events: none;
            z-index: 2;
            cursor: move;
            padding: 2px 4px;
            border: 2px solid transparent;
            transition: border-color 0.2s;
        }

        .coin-name {
            font-family: 'Geist-Medium', 'Inter', sans-serif;
            font-weight: 500;
            font-size: 41px;
            color: white;
            top: 111px;
            left: 30px;
        }

        .ticker {
            font-family: 'Geist-SemiBold', 'Inter', sans-serif;
            font-weight: 600;
            font-size: 57px;
            color: black;
            top: 173px;
            left: 132px;
        }

        .invested-value {
            font-family: 'Geist-Regular', 'Inter', sans-serif;
            font-weight: 400;
            font-size: 28px;
            color: white;
            top: 325px;
            left: 292px;
        }

        .position-value {
            font-family: 'Geist-Regular', 'Inter', sans-serif;
            font-weight: 400;
            font-size: 28px;
            color: white;
            top: 366px;
            left: 292px;
        }

        .percentage {
            font-family: 'Geist-Regular', 'Inter', sans-serif;
            font-weight: 400;
            font-size: 27px;
            color: #2fe3ac;
            top: 286px;
            left: 278px;
        }

        .percentage.negative {
            color: #ff4444;
        }

        .username {
            font-family: 'Geist-Medium', 'Inter', sans-serif;
            font-weight: 500;
            font-size: 41px;
            color: white;
            top: 442px;
            left: 92px;
        }

        /* Taskbar */
        .taskbar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 30px;
            background: #c0c0c0;
            border-top: 1px solid #808080;
            display: flex;
            align-items: center;
            padding: 0 5px;
            z-index: 1000;
        }

        .start-button {
            background: #c0c0c0;
            border: 2px outset #c0c0c0;
            padding: 2px 8px;
            font-size: 11px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .start-button:active {
            border: 2px inset #c0c0c0;
        }

        .taskbar-time {
            margin-left: auto;
            font-size: 11px;
            border: 1px inset #c0c0c0;
            padding: 2px 5px;
        }

        .taskbar-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-left: auto;
        }

        .ca-text {
            font-size: 11px;
            color: #000;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .window {
                width: 95%;
                height: 90%;
            }
            
            .window-content {
                flex-direction: column;
            }
            
            .form-section {
                width: 100%;
            }
            
            .card-preview {
                width: 100%;
                max-width: 400px;
                height: 271px;
                transform: scale(0.48);
                transform-origin: top left;
            }
            
            .card-container {
                width: 400px;
                height: 271px;
                overflow: hidden;
            }
        }
    </style>
</head>
<body>
    <div class="desktop">
        <!-- Desktop Icons -->
        <div class="desktop-icon icon-twitter" onclick="openTwitter()">
            <img src="https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/6830acbd03f5e3b5fc93764a_new-2023-twitter-logo-x-icon-design_1017-45418.avif" alt="Twitter">
            <span>X/Twitter</span>
        </div>

        <div class="desktop-icon icon-pumpfun" onclick="openPumpFun()">
            <img src="https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/6863e813b739082547cfec7a_BBqyuDPm_400x400.png" alt="Pump.fun">
            <span>Buy on Pump.fun</span>
        </div>

        <img src="https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/6834b956e8507cbdd0f0e789_9938a40807369ae9dce32dcb5678736d.gif" alt="" class="desktop-gif gif-1">
<img src="https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/6834bd640e02cc15498949d0_2832120.webp" alt="" class="desktop-gif gif-2">
<img src="https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/6834b99fe03a70165617c17b_c2e638163c830cd682928efe20d86f88.gif" alt="" class="desktop-gif gif-3">
<img src="https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/6834b9c86afb796987e7d7e7_2429514_e59a3.gif" alt="" class="desktop-gif gif-4">
<img src="https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/6834b9563eaa511838006052_y2k.gif" alt="" class="desktop-gif gif-5">

        <!-- Main Application Window -->
        <div class="window">
            <div class="title-bar">
                <div class="title-text">
                    <div class="window-icon"></div>
                    <span>PNL Card Generator - [Application]</span>
                </div>
                <div class="window-controls">
                    <div class="control-btn">_</div>
                    <div class="control-btn">â–¡</div>
                    <div class="control-btn">Ã—</div>
                </div>
            </div>

            <div class="window-content">
                <div class="form-section">
                    <div class="form-group">
                        <label for="coinName">Coin Name:</label>
                        <input type="text" id="coinName" value="FAKECOIN">
                    </div>
                    
                    <div class="form-group">
                        <label for="ticker">SOL Profit:</label>
                        <input type="text" id="ticker" value="22.52" readonly style="background: #e0e0e0; color: #666;">
                        <div style="font-size: 10px; color: #666; margin-top: 2px;">
                            Auto-calculated: Position - Invested
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="invested">Amount Invested:</label>
                        <input type="number" id="invested" step="0.01" value="1.98">
                    </div>
                    
                    <div class="form-group">
                        <label for="position">Current Position Value:</label>
                        <input type="number" id="position" step="0.01" value="24.5">
                    </div>
                    
                    <div class="form-group">
                        <label for="username">Username/Handle:</label>
                        <input type="text" id="username" value="@pnlfaker">
                    </div>

                    <div class="form-group">
                        <label for="pfpUpload">Profile Picture:</label>
                        <div class="file-input-wrapper">
                            <input type="file" id="pfpUpload" accept="image/*" onchange="handlePfpUpload(event)">
                            <label for="pfpUpload" class="file-input-label">
                                Choose Profile Pic...
                            </label>
                        </div>
                        <button class="win98-button" onclick="resetPfp()" style="width: 100%; margin-top: 5px;">
                            Remove Profile Pic
                        </button>
                    </div>

                    <div class="background-section">
                        <label>Custom Background:</label>
                        <div class="file-input-wrapper">
                            <input type="file" id="backgroundUpload" accept="image/*" onchange="handleBackgroundUpload(event)">
                            <label for="backgroundUpload" class="file-input-label">
                                Choose Image/GIF...
                            </label>
                        </div>
                        <button class="win98-button" onclick="resetBackground()" style="width: 100%; margin-top: 5px;">
                            Reset to Default
                        </button>
                    </div>

                    <div class="background-section">
                        <label>Referral Code:</label>
                        <button class="win98-button" style="width: 100%; background: #a0a0a0; color: #666; cursor: not-allowed;" disabled>
                            ðŸ”’ Get Referral Code
                        </button>
                        <div style="font-size: 10px; margin-top: 5px; color: #666;">
                            Feature coming soon...
                        </div>
                    </div>
                    
                    <button class="win98-button primary" onclick="downloadCard()" style="width: 100%; margin-top: 15px;">
                        Download PNL Card
                    </button>
                </div>

                <div class="preview-section">
                    <h3 style="font-size: 12px; margin-bottom: 10px; color: #000;">Preview:</h3>
                    
                    <div class="card-container">
                        <div class="card-preview" id="cardPreview">
                            <img id="customBackground" class="custom-background" style="display: none;">
                            <img id="pnlOverlay" class="pnl-overlay" style="display: none;">
                            <img id="profilePic" class="profile-pic" style="display: none;">
                            
                            <div class="draggable-text coin-name" id="coinNameText" data-name="coinName">FAKECOIN</div>
                            <div class="draggable-text ticker" id="tickerText" data-name="ticker">22.52</div>
                            <div class="draggable-text invested-value" id="investedValue" data-name="investedValue">1.98</div>
                            <div class="draggable-text position-value" id="positionValue" data-name="positionValue">24.5</div>
                            <div class="draggable-text percentage" id="percentageText" data-name="percentage">1135.51%</div>
                            <div class="draggable-text username" id="usernameText" data-name="username">@TEMPLATE</div>
                        </div>
                    </div>

                    <div class="status-text">
                        PNL FAKER â€¢ PNL Card Generator v1.0
                    </div>
                </div>
            </div>
        </div>

        <!-- Coordinates Display - Hidden -->
        <div id="coordinatesDisplay" style="display: none !important;">
            <strong>Current Coordinates (top, left, right, bottom):</strong><br>
            <div id="coordList"></div>
        </div>
    </div>

    <!-- Taskbar -->
    <div class="taskbar">
        <button class="start-button">
            <span style="background: #008000; width: 12px; height: 12px; display: block;"></span>
            Start
        </button>
        <div class="taskbar-info">
            <span class="ca-text">CA:</span>
            <div class="taskbar-time" id="taskbarTime">12:00 PM</div>
        </div>
    </div>
    <script>
        let customBackgroundSet = false;
        let profilePicSet = false;

        // Update taskbar time
        function updateTime() {
            const now = new Date();
            const time = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            document.getElementById('taskbarTime').textContent = time;
        }
        updateTime();
        setInterval(updateTime, 1000);

        // Desktop icon functions
        function openTwitter() {
            window.open('https://x.com/PNLFaker', '_blank');
        }

        function openPumpFun() {
            window.open('https://pump.fun', '_blank');
        }

        // Background upload functionality
        function handleBackgroundUpload(event) {
    const file = event.target.files[0];
    if (file) {
        console.log('File type:', file.type);
        console.log('File name:', file.name);
        
        const reader = new FileReader();
        reader.onload = function(e) {
            const customBg = document.getElementById('customBackground');
            customBg.src = e.target.result;
            customBg.style.display = 'block';
            customBackgroundSet = true;
            
            console.log('Background set to:', e.target.result.substring(0, 50) + '...');
            
            updatePnlOverlay();
        };
        reader.readAsDataURL(file);
    }
}

        function resetBackground() {
            const customBg = document.getElementById('customBackground');
            const pnlOverlay = document.getElementById('pnlOverlay');
            customBg.style.display = 'none';
            customBg.src = '';
            pnlOverlay.style.display = 'none';
            pnlOverlay.src = '';
            customBackgroundSet = false;
            document.getElementById('backgroundUpload').value = '';
        }

        function updatePnlOverlay() {
            if (!customBackgroundSet) return;
            
            const invested = parseFloat(document.getElementById('invested').value) || 1.98;
            const position = parseFloat(document.getElementById('position').value) || 24.5;
            const rawProfit = position - invested;
            const isProfit = rawProfit >= 0;
            
            const pnlOverlay = document.getElementById('pnlOverlay');
            
            if (isProfit) {
                pnlOverlay.src = 'https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/6834a8a45948936715329db3_customwinner.png';
            } else {
                pnlOverlay.src = 'https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/6834a8a45948936715329daf_customloser.png';
            }
            
            pnlOverlay.style.display = 'block';
        }

        // Profile picture upload functionality
        function handlePfpUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const profilePic = document.getElementById('profilePic');
                    const cardPreview = document.getElementById('cardPreview');
                    
                    profilePic.src = e.target.result;
                    profilePic.style.display = 'block';
                    profilePicSet = true;
                    
                    if (!customBackgroundSet) {
                        cardPreview.style.backgroundImage = "url('https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/6834abe3c3dd94c4b9edb035_FINALPNLCARDdddd%20(1).png')";
                    }
                };
                reader.readAsDataURL(file);
            }
        }

        function resetPfp() {
            const profilePic = document.getElementById('profilePic');
            const cardPreview = document.getElementById('cardPreview');
            
            profilePic.style.display = 'none';
            profilePic.src = '';
            profilePicSet = false;
            document.getElementById('pfpUpload').value = '';
            
            if (!customBackgroundSet) {
                cardPreview.style.backgroundImage = "url('https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/6834abe3c3dd94c4b9edb035_FINALPNLCARDdddd%20(1).png')";
            }
        }

        function updatePreview() {
            const coinName = document.getElementById('coinName').value || 'PNLBBL';
            const invested = parseFloat(document.getElementById('invested').value) || 1.98;
            const position = parseFloat(document.getElementById('position').value) || 24.5;
            const username = document.getElementById('username').value || '@TEMPLATE';
            
            // Calculate SOL profit (position - invested)
            const solProfitRaw = position - invested;
            const solProfit = Math.abs(solProfitRaw);
            const ticker = solProfit.toFixed(2);
            
            // Calculate percentage
            const percentage = invested > 0 ? ((position - invested) / invested * 100) : 0;
            const isPositive = solProfitRaw >= 0;
            
            // Update preview
            document.getElementById('coinNameText').textContent = coinName.toUpperCase();
            document.getElementById('tickerText').textContent = ticker;
            document.getElementById('ticker').value = ticker;
            document.getElementById('investedValue').textContent = `${invested.toFixed(2)}`;
            document.getElementById('positionValue').textContent = `${position.toFixed(2)}`;
            document.getElementById('usernameText').textContent = username;
            
            const percentageElement = document.getElementById('percentageText');
            percentageElement.textContent = `${isPositive ? '+' : ''}${percentage.toFixed(2)}%`;
            percentageElement.className = `draggable-text percentage ${isPositive ? '' : 'negative'}`;
            
            // Change default background based on profit/loss (only if no custom background)
            if (!customBackgroundSet) {
                const cardPreview = document.getElementById('cardPreview');
                if (isPositive) {
                    cardPreview.style.backgroundImage = "url('https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/683495c0f008abc19b88aaf3_FINALPNLCARDdddd.png')";
                } else {
                    cardPreview.style.backgroundImage = "url('https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/6834b42b6cf4d19f455182aa_FINALPNLCARDdddd%20(1)%20(1).png')";
                }
            }
            
            updatePnlOverlay();
        }

        async function downloadCard() {
    const coinName = document.getElementById('coinName').value || 'FAKECOIN';
    const customBg = document.getElementById('customBackground');
    
    // Debug logging
    console.log('customBackgroundSet:', customBackgroundSet);
    console.log('customBg.src:', customBg.src);
    console.log('customBg.src type:', typeof customBg.src);
    
    const isUsingGif = customBackgroundSet && customBg.src && 
                      (customBg.src.toLowerCase().includes('.gif') || 
                       customBg.src.includes('data:image/gif'));
    
    console.log('isUsingGif:', isUsingGif);
    
    if (isUsingGif) {
        console.log('Creating animated GIF...');
        await downloadAnimatedGif(coinName);
    } else {
        console.log('Creating static PNG...');
        await downloadStaticPng(coinName);
    }
}

async function downloadAnimatedGif(coinName) {
    const downloadBtn = document.querySelector('.win98-button.primary');
    const originalText = downloadBtn.textContent;
    
    try {
        downloadBtn.textContent = 'Creating GIF...';
        downloadBtn.disabled = true;
        
        const cardElement = document.getElementById('cardPreview');
        
        // Much smaller size and fewer frames
        const width = 200;
        const height = 135;
        const frameCount = 3;
        
        // Create GIF encoder
        const encoder = new GIFEncoder(width, height);
        encoder.setRepeat(0); // 0 = loop forever
        encoder.setDelay(400); // 400ms delay
        encoder.setQuality(20); // Lower quality for smaller file
        encoder.start();
        
        // Capture frames
        for (let i = 0; i < frameCount; i++) {
            downloadBtn.textContent = `Frame ${i + 1}/${frameCount}`;
            
            await new Promise(resolve => setTimeout(resolve, 500));
            
            const canvas = await html2canvas(cardElement, {
                width: width,
                height: height,
                scale: 0.24, // Very small scale
                useCORS: true,
                allowTaint: true,
                backgroundColor: null,
                logging: false
            });
            
            const ctx = canvas.getContext('2d');
            const imageData = ctx.getImageData(0, 0, width, height);
            encoder.addFrame(imageData.data);
        }
        
        encoder.finish();
        
        // Get the GIF as bytes
        const bytes = encoder.out.getData();
        const blob = new Blob([new Uint8Array(bytes)], {type: 'image/gif'});
        
        // Download
        const link = document.createElement('a');
        link.download = `${coinName}_PNL_Card.gif`;
        link.href = URL.createObjectURL(blob);
        link.click();
        
        downloadBtn.textContent = originalText;
        downloadBtn.disabled = false;
        
    } catch (error) {
        console.error('GIF creation failed:', error);
        downloadBtn.textContent = originalText;
        downloadBtn.disabled = false;
        
        // Simple fallback - just inform user and download PNG
        alert('GIF export is having technical issues. Downloading high-quality PNG instead!');
        await downloadStaticPng(coinName);
    }
}
        
async function downloadStaticPng(coinName) {
    try {
        const cardElement = document.getElementById('cardPreview');
        
        const canvas = await html2canvas(cardElement, {
            width: 840,
            height: 570,
            scale: 1,
            useCORS: true,
            allowTaint: true,
            backgroundColor: null,
            logging: false
        });
        
        const link = document.createElement('a');
        link.download = `${coinName}_PNL_Card.png`;
        link.href = canvas.toDataURL('image/png', 1.0);
        link.click();
        
    } catch (error) {
        console.error('PNG download failed:', error);
    }
}
        
        // Add event listeners
        document.getElementById('coinName').addEventListener('input', updatePreview);
        document.getElementById('invested').addEventListener('input', updatePreview);
        document.getElementById('position').addEventListener('input', updatePreview);
        document.getElementById('username').addEventListener('input', updatePreview);
        
        // Initialize
        updatePreview();
    </script>
</body>
</html>
